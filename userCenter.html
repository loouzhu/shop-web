<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <!-- 引入Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net.cn/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <!-- 引入公共css -->
  <link rel="stylesheet" href="./css/public.css" />
  <link rel="stylesheet" href="./css/userCenter.css">
</head>

<body>
  <!-- 头部 -->
  <header>
    <div class="left">商店</div>
    <div class="right" id="nav">
      <ul>
        <li><a href="./login.html">请先登录</a></li>
        <li><a href="./index.html">前往主页</a></li>
        <li><a href="./shopCar.html" data-id="shopCar">购物车</a></li>
        <li><a href="./userCenter.html" data-id="userCenter">用户中心</a></li>
      </ul>
    </div>
  </header>
  <!-- toast 提示框 -->
  <div class="toast my-toast" data-bs-delay="1500">
    <div class="toast-body">
      <div class="alert alert-success info-box">
        操作成功
      </div>
    </div>
  </div>
  <!-- 核心内容区域 -->
  <div class="container">
    <ul class="my-nav">
      <li class="active">基本设置</li>
      <li>安全设置</li>
      <li>账号绑定</li>
      <li>新消息通知</li>
    </ul>
    <div class="content">
      <div class="info-wrap">
        <h3 class="title">基本设置</h3>
        <form class="user-form" action="javascript:;">
          <div class="form-item">
            <label for="email">邮箱</label>
            <input id="email" name="email" class="email" type="text" placeholder="请输入邮箱" autocomplete="off">
          </div>
          <div class="form-item">
            <label for="nickname">昵称</label>
            <input id="nickname" name="nickname" class="nickname" type="text" placeholder="请输入昵称" autocomplete="off">
          </div>
          <div class="form-item">
            <label>性别</label>
            <label class="male-label"><input type="radio" name="gender" class="gender" value="0">男</label>
            <label class="male-label"><input type="radio" name="gender" class="gender" value="1">女</label>
          </div>
          <div class="form-item">
            <label for="desc">个人简介</label>
            <textarea id="desc" name="desc" class="desc" placeholder="请输入个人简介" cols="20" rows="10"
              autocomplete="off"></textarea>
          </div>
          <button class="submit">提交</button>
        </form>
      </div>
      <div class="avatar-box">
        <h4 class="avatar-title">头像</h3>
          <img class="prew" src="./img/头像.png" alt="">
          <label for="upload">更换头像</label>
          <input id="upload" type="file" class="upload">
      </div>

    </div>
  </div>
  <!-- 底部 -->
  <footer>
    <div class="container">
      <div class="left">
        <h5>客户服务</h5>
        <div class="service">
          <img src="./other/客户服务二维码.png" alt="客户服务">
        </div>
      </div>
      <div class="middle">
        <h5>关注我们</h5>
        <div class="attention">
          <img src="./other/关注我们二维码.png" alt="关注我们">
        </div>
      </div>
      <div class="right">
        <h5>联系热线</h5>
        <h3>123-456-789</h3>
      </div>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
  <script src="/form-serialize.js"></script>
  <script>
    // 获取用户数据
    const creator = 'abc'
    axios({
      url: 'http://hmajax.itheima.net/api/settings',
      method: 'GET',
      params: {
        creator
      }
    }).then(res => {
      const userObj = res.data.data
      console.log(userObj)
      //Object.keys()可以拿到一个对象里面所有的属性名并放在数组里面返回
      Object.keys(userObj).map(key => {
        if (key === 'avatar') document.querySelector('.prew').src = userObj[key]
        else if (key === 'desc') document.querySelector('.desc').value = userObj[key]
        else if (key === 'email') document.querySelector('.email').value = userObj[key]
        else if (key === 'gender') {
          const gender = document.querySelectorAll('.gender')
          //console.log(gender)
          const gNum = userObj[key]
          console.log(gNum)
          gender[gNum].checked = true
        }
        else document.querySelector('.nickname').value = userObj[key]
      })
    })

    // 修改用户头像
    document.querySelector('.upload').addEventListener('change', (e) => {
      const fd = new FormData()
      fd.append('avater', e.target.files[0])
      fd.append('creator', 'abc')
      axios({
        url: 'http://hmajax.itheima.net/api/avatar',
        method: "PUT",
        data: fd,
      }).then(res => {
        const imgUrl = res.data.data.avatar
        document.querySelector('.prew').src = imgUrl
      })
    })

    // 修改用户信息
    document.querySelector('.submit').addEventListener('click', () => {
      // 收集表单信息
      const userForm = document.querySelector('.user-form')
      const userData = serialize(userForm, { hash: true, empty: true })
      userData.creator = creator
      userData.gender = parseInt(userData.gender)
      //console.log(userData)
      axios({
        url: 'https://hmajax.itheima.net/api/settings',
        method: "PUT",
        data: userData
      }).then(res => {
        console.log('修改成功', userData)
        //弹窗提示修改成功
        const modalBox = document.querySelector('.toast')
        const modal = new bootstrap.Toast(modalBox)
        modal.show()
      })
    })
  </script>
</body>

</html>